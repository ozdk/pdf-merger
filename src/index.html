<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Security headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; worker-src 'self' blob:; child-src blob:; connect-src 'none'; font-src 'self'; form-action 'none'; object-src 'none'; frame-ancestors 'none'; base-uri 'self'; manifest-src 'self';">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta name="referrer" content="no-referrer">
    <meta name="theme-color" content="#f40f02">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="PDF Merger">
    
    <title>PDF Merger | Secure Document Merging</title>
    <meta name="description" content="Securely merge multiple PDF files into one document without uploading them to any server">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="lib/pdf-lib.min.js" as="script">
    <link rel="preload" href="lib/pdf.js" as="script">
    <link rel="preload" href="css/styles.css" as="style">
    
    <link rel="stylesheet" href="css/styles.css">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%23f40f02' d='M12 14.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm0-5.5c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0-5.5C7.31 3.5 3.5 7.31 3.5 12S7.31 20.5 12 20.5s8.5-3.81 8.5-8.5S16.69 3.5 12 3.5z'/%3E%3C/svg%3E" type="image/svg+xml">
</head>
<body>
    <header>
        <h1>PDF Merger</h1>
        <p class="tagline">Securely merge your PDF files in your browser</p>
    </header>

    <main id="main-content" class="container">
        <!-- Upload section -->
        <section class="upload-section">
            <h2 class="section-title">Upload Files</h2>
            
            <div class="drop-zone" 
                 id="drop-zone" 
                 role="button" 
                 tabindex="0"
                 aria-label="Upload PDF files" 
                 aria-describedby="drop-zone-description">
                <div class="drop-zone-prompt">
                    <svg class="upload-icon" xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    <p id="drop-zone-description">Drag & drop PDF files here<br>or</p>
                    <label for="file-input" class="file-input-label">Choose Files</label>
                    <input type="file" id="file-input" multiple accept="application/pdf" class="file-input-hidden">
                </div>
            </div>

            <!-- Update the file list container section to include reordering functionality -->
            <div class="file-list-container">
                <h3>Selected Files</h3>
                <p class="file-list-instructions">Select a file and use the arrows to change the merge order</p>
                <ul id="file-list" class="file-list" aria-live="polite"></ul>
                <div class="file-actions">
                    <button id="move-up" class="btn btn-sm" title="Move selected file up" disabled aria-label="Move selected file up in order">↑</button>
                    <button id="move-down" class="btn btn-sm" title="Move selected file down" disabled aria-label="Move selected file down in order">↓</button>
                    <button id="remove-selected" class="btn btn-sm" title="Remove selected file" disabled>×</button>
                </div>
            </div>

            <div class="actions">
                <button id="clear-files" class="btn btn-secondary" type="button">Clear All</button>
                <button id="merge-button" class="btn btn-primary" type="button" disabled>Merge PDFs</button>
            </div>
        </section>

        <!-- Results section -->
        <section id="results-section" class="results-section hidden">
            <div class="results-container">
                <h2>Your PDF is Ready!</h2>
                <div class="pdf-preview" id="pdf-preview" role="region" aria-label="PDF preview"></div>
                <div class="download-info">
                    <p id="file-info">File size: <span id="file-size">--</span></p>
                    <a id="download-link" class="btn btn-success" download="merged.pdf">Download Merged PDF</a>
                    <button id="start-over" class="btn btn-secondary" type="button">Start Over</button>
                </div>
            </div>
        </section>
        
        <!-- How it works section -->
        <section class="how-it-works">
            <h2>How It Works</h2>
            <div class="steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <h3>Upload Files</h3>
                    <p>Select multiple PDF files or drag and drop them into the upload area</p>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <h3>Merge PDFs</h3>
                    <p>Click the "Merge PDFs" button to combine all files into one document</p>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <h3>Download Result</h3>
                    <p>Preview and download your merged PDF file</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Loading overlay -->
    <div id="loading-overlay" class="loading-overlay hidden" role="alertdialog" aria-busy="true" aria-label="Processing">
        <div class="spinner" aria-hidden="true"></div>
        <p>Merging your PDFs...</p>
    </div>

    <footer>
        <div class="footer-content">
            <p class="security-note"><strong>🔒 Secure Processing:</strong> Your files are processed entirely in your browser. Nothing is uploaded to any server.</p>
            <p class="copyright">&copy; 2025 PDF Merger | <a href="#privacy-policy" id="privacy-link">Privacy Policy</a></p>
        </div>
    </footer>

    <!-- Privacy modal -->
    <div id="privacy-modal" class="modal hidden" role="dialog" aria-labelledby="privacy-title" aria-hidden="true">
        <div class="modal-content">
            <span class="close-modal" aria-label="Close">&times;</span>
            <h2 id="privacy-title">Privacy Policy</h2>
            <p>This PDF Merger tool processes all files directly in your web browser. We do not upload, store, or transmit your files to any server. All processing happens locally on your device.</p>
            <p>We collect no personal data, do not use cookies, and do not track your usage of this tool.</p>
            <div class="technical-details">
                <h3>Technical Implementation</h3>
                <ul>
                    <li><strong>No Server Communication:</strong> This application has no backend server component.</li>
                    <li><strong>Local Processing:</strong> All PDF merging happens using JavaScript libraries (pdf-lib.js and pdf.js) that execute in your browser.</li>
                    <li><strong>No Storage:</strong> We don't use cookies, localStorage, or IndexedDB to store any information.</li>
                    <li><strong>Network Monitoring:</strong> The application includes visible indicators when any network activity occurs.</li>
                    <li><strong>Source Code:</strong> <a href="https://github.com/yourusername/pdf-merger" target="_blank">View our source code</a> to verify these privacy claims.</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Add this before your existing scripts -->
    <script>
        // File type validation helper
        window.validatePdfFile = function(file) {
            // Check MIME type
            if (file.type !== 'application/pdf') {
                return false;
            }
            
            // Check file extension
            const fileExtension = file.name.split('.').pop().toLowerCase();
            if (fileExtension !== 'pdf') {
                return false;
            }
            
            return true;
        };
    </script>

    <!-- Data safety monitoring script -->
    <script>
        // Clear browser storage when app starts and finishes
        window.addEventListener('DOMContentLoaded', () => {
            // Clear any potential storage
            localStorage.clear();
            sessionStorage.clear();
            
            // Clear IndexedDB if present
            window.indexedDB.databases().then(dbs => {
                dbs.forEach(db => window.indexedDB.deleteDatabase(db.name));
            }).catch(() => {});
            
            // Clear cache storage if possible
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => caches.delete(name));
                });
            }
        });
        
        // Add visible indicator of offline processing
        const networkIndicator = document.createElement('div');
        networkIndicator.className = 'network-indicator';
        networkIndicator.innerHTML = '<span class="network-status online">✓ Offline Processing Active</span>';
        document.body.appendChild(networkIndicator);
        
        // Monitor network requests to ensure transparency
        const originalFetch = window.fetch;
        window.fetch = function() {
            const indicator = document.querySelector('.network-status');
            if (indicator) {
                indicator.textContent = "⚠️ Network Request Detected";
                indicator.classList.remove('online');
                setTimeout(() => {
                    indicator.textContent = "✓ Offline Processing Active";
                    indicator.classList.add('online');
                }, 3000);
            }
            return originalFetch.apply(this, arguments);
        };
    </script>

    <!-- Scripts with optimization attributes -->
    <script src="lib/pdf-lib.min.js" defer></script>
    <script src="lib/pdf.js" defer></script>
    <script src="js/fileUtils.js" defer></script>
    <script src="js/pdfMerger.js" defer></script>
    <script src="js/app.js" defer></script>
</body>
</html>